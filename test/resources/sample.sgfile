# Assuming mountpoints already exist?
# SOURCE: current HEAD of test_mount or commit hash if specified.
SOURCE test_mount
SOURCE test_mount_mongo

# Marking a mounted schema as OUTPUT means it gets committed after every command.
# The hash is H(sum(H(all source layers) + H(command))
# We assume that the executed SQL only writes to the output schema and isn't the same as the input schema
# (even though it can be the same database mounted at two points).

# Output to an empty schema that will be created
OUTPUT output 00000000

SQL create table output.fruits as select * from test_mount.fruits where length(test_mount.fruits.name) > 5

SQL insert into output.fruits values (10, 'pikachu')

SQL create table output.spirit_fruits as select test_mount.fruits.fruit_id, \
    test_mount_mongo.stuff.name, test_mount.fruits.name as spirit_fruit from test_mount.fruits \
    join test_mount_mongo.stuff on test_mount.fruits.fruit_id = test_mount_mongo.stuff.duration
